---
title: "Soil-Mates"
output: html_document
---

#### Packages
```{r}
library(dplyr)
library(vegan)
library(tidyverse)
```
#### Importing all at one
```{r}
temp <- list.files("./Data",pattern="*.csv", full.names = T) #creates an object that contains a string of file names with directory so they can be located
Dat <- list() # creates an empty vector used in the for loop
for (i in seq_along(temp)) { # creates a list (I dont know if this is the right term) of dataframes
  Dat[[i]] <- read.csv(
    file = temp[[i]]
  )
}
names <- c("En10", "En20", "Ar10", "Ba10", "Fu10", "Ar20", "Ba20", "Fu20", "En") #probably a better way to name the elements in Dat - increase reproducibility
Dat <- set_names(Dat, names) # sets the names for the data frames in Dat
```
#### Preprocessing before data is combined
```{r}
Dat$Fu10 <- Dat$Fu10 %>% #Removes extras from Fungi
  select(-Trophic.Mode,-Guild,-Confidence.Ranking)
```
```{r}
Dat$Fu20 <- Dat$Fu20 %>% #Removes extras from Fungi
  select(-Trophic.Mode,-Guild,-Confidence.Ranking) 
```
```{r}
Dat$Ba10 <- Dat$Ba10 %>% # Fixes capitalization
  rename(Cluster=(cluster)) 
```
```{r}
Dat$Ar10 <- Dat$Ar10 %>% # Fixes capitalization
  rename(Phyla=(phylum),
         Class=(class),
         Order=(order),
         Family=(family))
```
```{r}
Dat$En10 <- Dat$En10 %>% # Possibly unnecessary
  rename(Archaea=(Archaea_010cm),
         Bacteria=(Bacteria_010cm),
         Fungi=(Fungi_010cm))
```

```{r}
Dat$En20 <- Dat$En20 %>% # Makes so that when both Enviro tables are combined names match
  rename(Clearcut=(CLF),
         Salvage=(Salv_log),
         Organic.Carbon=(Organic.Carbon_prop),
         Exc.Magnesium=(Exc..Magnesium),
         pH.CaCl2.=(pH.Level..CaCl2.),
         Archaea=(Archaea_020cm),
         Bacteria=(Bacteria_020cm),
         Fungi=(Fungi_020cm)) %>%
  mutate(TSD= as.numeric(TSD)-1)
```
#### Combines datasets - reproducibility likely can be enhanced - this one uses the Importing all at once
```{r}
En<-bind_rows(Dat$En10,Dat$En20) #Combines Enviro tables into one dataset
D10<-bind_rows(Dat$Ar10,Dat$Ba10,Dat$Fu10) # Combines all for at depth 10 
D20<-bind_rows(Dat$Ar20,Dat$Ba20,Dat$Fu20) # Combines all microbes for for depth of 20
```

```{r}
#Writing En into Data folder to open in Question 2 rmd
write.csv(En, file = "./Data/En.csv")
```

#### Please ignore - this belongs in question 1
#### Diversity
```{r}
tD10 <- D10 #creates new object to be manipulated for diversity calculations
tD10 <- tD10 %>%
  select(-Cluster, -Sample, -Phyla, -Class, -Order, -Family)
tD10 <- t(tD10) #Transposes file
```

```{r}
Div1 <- diversity(tD10, index = "shannon", MARGIN = 1, base= exp(1))
```

```{r}
tD20 <- D20
tD20 <- tD20 %>%
  select(-Cluster, -Sample, -Phyla, -Class, -Order, -Family)
tD20 <- t(tD20)
```

```{r}
Div2 <- diversity(tD20, index = "shannon", MARGIN = 1, base= exp(1))
```

```{r}
EnQ1 <- En
EnQ1$Div <- c(Div1, Div2)
```

#### Add proper names to a new column for Destructive History in a New environemental table - Needing fixing see below
```{r}
EnM <- EnQ1
EnM$Destructive_History[EnM$No.Fires== 0 & EnM$Clearcut == 0 & EnM$Salvage == 0 & EnM$TSD == 167] <- "1850F"
EnM$Destructive_History[EnM$No.Fires== 1 & EnM$Clearcut == 0 & EnM$Salvage == 0 & EnM$TSD == 78] <- "1939F"
EnM$Destructive_History[EnM$No.Fires== 2 & EnM$Clearcut == 0 & EnM$Salvage == 0 & EnM$TSD == 34] <- "1939/1983F"
EnM$Destructive_History[EnM$No.Fires== 2 & EnM$Clearcut == 0 & EnM$Salvage == 0 & EnM$TSD == 8] <- "1939/2009F"
EnM$Destructive_History[EnM$No.Fires== 3 & EnM$Clearcut == 0 & EnM$Salvage == 0 & EnM$TSD == 8] <- "1939/1983/2009F"
EnM$Destructive_History[EnM$No.Fires== 1 & EnM$Clearcut == 1 & EnM$Salvage == 0 & EnM$TSD == 34] <- "1939F/1980CC"
EnM$Destructive_History[EnM$No.Fires== 1 & EnM$Clearcut == 1 & EnM$Salvage == 0 & EnM$TSD == 8] <- "1939F/2009CC"
EnM$Destructive_History[EnM$No.Fires== 2 & EnM$Clearcut == 0 & EnM$Salvage == 1 & EnM$TSD == 8] <- "1939/2009F/2009SL"
EnM$Destructive_History[EnM$No.Fires== 2 & EnM$Clearcut == 1 & EnM$Salvage == 0 & EnM$TSD == 8] <- "1939/1983F/2009CC"
```

#### Preferable for loop that does the same thing but Joel couldn't figure out 
#{r}
EnM <- En
EnM$Destructive_History <- list(length(EnM))
for(i in length(EnM)) {
  if((EnM$No.Fires== 0) && (EnM$Clearcut == 0) && (EnM$Salvage == 0) && (EnM$TSD == 168))
  { replace(EnM$Destructive_History <- "1850F")
  }
}

```{r}
ggplot(EnM, aes(x=Depth, y=Div)) +
    geom_boxplot(aes(colour=I("black"), fill=Destructive_History)) +  
    labs(y="Alpha Diversity", 
         x="Depth of sample",
         fill="Destructive History") + 
  scale_x_discrete(labels=c("0-10cm", "20-30cm")) +
        theme_classic()
```

## Research Questions 3

```{r}
EnM

 
```




